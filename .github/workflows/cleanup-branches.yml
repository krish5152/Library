name: Delete Newly Created Branches

on:
  schedule:
    # Runs at 12:35 PM every day
    - cron: '35 12 * * *'

  workflow_dispatch: # Allows manual triggering of the workflow
  
jobs:
  delete-new-branches:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install Git
        run: sudo apt-get install git

      - name: Fetch all branches
        run: git fetch --all --prune

      - name: Delete newly created branches (within the last day)
        run: |
          for branch in $(git for-each-ref --sort=-committerdate refs/remotes --format='%(refname:short) %(creatordate:relative)' | grep -E 'hours|day ago' | awk '{print $1}'); do
            if [[ $branch != "origin/main" && $branch != "origin/master" ]]; then  # Exclude main/master branches
              git push origin --delete ${branch#origin/}
              echo "Deleted branch: $branch"
            fi
          done
